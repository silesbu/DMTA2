<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Statistics with R</title>
  <meta name="description" content="Syllabus for the course ‘Statistics with R’">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Statistics with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Syllabus for the course ‘Statistics with R’" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Statistics with R" />
  
  <meta name="twitter:description" content="Syllabus for the course ‘Statistics with R’" />
  

<meta name="author" content="Douwe Molenaar">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="amt-carrier.html">
<link rel="next" href="nerve-fiber.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script language="javascript">
  function toggle(showHideDiv, switchTextDiv) {
  	var ele = document.getElementById(showHideDiv);
	  var text = document.getElementById(switchTextDiv);
	  if(ele.style.display == "block") {
	  	ele.style.display = "none";
	  	text.innerHTML = "Show solution";
	  }
	  else {
	  	ele.style.display = "block";
      text.innerHTML = "Hide solution";
	  }
  }
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="styles/style.css" type="text/css" />
<link rel="stylesheet" href="styles/block_elements.css" type="text/css" />
<link rel="stylesheet" href="styles/localadapt.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Colophon</a></li>
<li class="chapter" data-level="1" data-path="studyguide.html"><a href="studyguide.html"><i class="fa fa-check"></i><b>1</b> Study guide</a><ul>
<li class="chapter" data-level="1.1" data-path="studyguide.html"><a href="studyguide.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="studyguide.html"><a href="studyguide.html#entry-conditions"><i class="fa fa-check"></i><b>1.2</b> Entry conditions</a></li>
<li class="chapter" data-level="1.3" data-path="studyguide.html"><a href="studyguide.html#goal-of-the-course"><i class="fa fa-check"></i><b>1.3</b> Goal of the course</a><ul>
<li class="chapter" data-level="1.3.1" data-path="studyguide.html"><a href="studyguide.html#this-is-not-a-statistics-course"><i class="fa fa-check"></i><b>1.3.1</b> This is not a statistics course</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="studyguide.html"><a href="studyguide.html#workload"><i class="fa fa-check"></i><b>1.4</b> Workload</a></li>
<li class="chapter" data-level="1.5" data-path="studyguide.html"><a href="studyguide.html#setup-and-content-of-the-course"><i class="fa fa-check"></i><b>1.5</b> Setup and content of the course</a><ul>
<li class="chapter" data-level="1.5.1" data-path="studyguide.html"><a href="studyguide.html#walk-in-hours"><i class="fa fa-check"></i><b>1.5.1</b> Walk-in hours</a></li>
<li class="chapter" data-level="1.5.2" data-path="studyguide.html"><a href="studyguide.html#syllabus"><i class="fa fa-check"></i><b>1.5.2</b> Syllabus</a></li>
<li class="chapter" data-level="1.5.3" data-path="studyguide.html"><a href="studyguide.html#assignments"><i class="fa fa-check"></i><b>1.5.3</b> Assignments</a></li>
<li class="chapter" data-level="1.5.4" data-path="studyguide.html"><a href="studyguide.html#assessment"><i class="fa fa-check"></i><b>1.5.4</b> Assessment</a></li>
<li class="chapter" data-level="1.5.5" data-path="studyguide.html"><a href="studyguide.html#evaluation-of-the-course"><i class="fa fa-check"></i><b>1.5.5</b> Evaluation of the course</a></li>
<li class="chapter" data-level="1.5.6" data-path="studyguide.html"><a href="studyguide.html#course-schedule"><i class="fa fa-check"></i><b>1.5.6</b> Course schedule</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Technical background</b></span></li>
<li class="chapter" data-level="2" data-path="quick-start.html"><a href="quick-start.html"><i class="fa fa-check"></i><b>2</b> A quick start</a><ul>
<li class="chapter" data-level="2.1" data-path="quick-start.html"><a href="quick-start.html#what-is-r"><i class="fa fa-check"></i><b>2.1</b> What is R?</a></li>
<li class="chapter" data-level="2.2" data-path="quick-start.html"><a href="quick-start.html#resources-for-learning-r"><i class="fa fa-check"></i><b>2.2</b> Resources for learning R</a></li>
<li class="chapter" data-level="2.3" data-path="quick-start.html"><a href="quick-start.html#other-sources-on-the-use-of-r"><i class="fa fa-check"></i><b>2.3</b> Other sources on the use of R</a></li>
<li class="chapter" data-level="2.4" data-path="quick-start.html"><a href="quick-start.html#installation-of-r"><i class="fa fa-check"></i><b>2.4</b> Installation of R</a></li>
<li class="chapter" data-level="2.5" data-path="quick-start.html"><a href="quick-start.html#starting-r"><i class="fa fa-check"></i><b>2.5</b> Starting R</a></li>
<li class="chapter" data-level="2.6" data-path="quick-start.html"><a href="quick-start.html#obtaining-help"><i class="fa fa-check"></i><b>2.6</b> Obtaining help</a></li>
<li class="chapter" data-level="2.7" data-path="quick-start.html"><a href="quick-start.html#an-r-session"><i class="fa fa-check"></i><b>2.7</b> An R-session</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html"><i class="fa fa-check"></i><b>3</b> Elementary data types and operations</a><ul>
<li class="chapter" data-level="3.1" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#the-atomic-data-types"><i class="fa fa-check"></i><b>3.1</b> The atomic data types</a></li>
<li class="chapter" data-level="3.2" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#the-basic-data-object-classes"><i class="fa fa-check"></i><b>3.2</b> The basic data object classes</a></li>
<li class="chapter" data-level="3.3" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#assigning-names-to-r-objects"><i class="fa fa-check"></i><b>3.3</b> Assigning names to R-objects</a><ul>
<li class="chapter" data-level="3.3.1" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#listing-objects-in-memory"><i class="fa fa-check"></i><b>3.3.1</b> Listing objects in memory</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#arithmetic-with-vectors-arrays-and-data-frames"><i class="fa fa-check"></i><b>3.4</b> Arithmetic with vectors, arrays, and data frames</a></li>
<li class="chapter" data-level="3.5" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#extracting-and-replacing-parts-of-data-objects"><i class="fa fa-check"></i><b>3.5</b> Extracting and replacing parts of data objects</a><ul>
<li class="chapter" data-level="3.5.1" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#extracting-a-single-sub-object-with-the-double-bracket-index-selector"><i class="fa fa-check"></i><b>3.5.1</b> Extracting a single sub-object with the double bracket index selector <code>[[</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#for-data-frames-and-lists-and-selectors-behave-similarly"><i class="fa fa-check"></i><b>3.5.2</b> For data frames and lists <code>$</code> and <code>[[</code> selectors behave similarly</a></li>
<li class="chapter" data-level="3.5.3" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#complement-syntax"><i class="fa fa-check"></i><b>3.5.3</b> Selecting portions with the single bracket selector <code>[</code></a></li>
<li class="chapter" data-level="3.5.4" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#changing-parts-of-a-vector"><i class="fa fa-check"></i><b>3.5.4</b> Changing parts of a vector</a></li>
<li class="chapter" data-level="3.5.5" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#effect-of-the-selector-operators-on-data-frames"><i class="fa fa-check"></i><b>3.5.5</b> Effect of the selector operators on data frames</a></li>
<li class="chapter" data-level="3.5.6" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#effect-of-the-selector-operators-on-arrays"><i class="fa fa-check"></i><b>3.5.6</b> Effect of the selector operators on arrays</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#removingelements"><i class="fa fa-check"></i><b>3.6</b> Removing elements from objects</a></li>
<li class="chapter" data-level="3.7" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#coercion"><i class="fa fa-check"></i><b>3.7</b> Data class conversion or coercion</a></li>
<li class="chapter" data-level="3.8" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#exercises"><i class="fa fa-check"></i><b>3.8</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#selection"><i class="fa fa-check"></i>Selection</a></li>
<li class="chapter" data-level="" data-path="elementary-datatypes.html"><a href="elementary-datatypes.html#more-selection-vectors-and-sequences"><i class="fa fa-check"></i>More selection, vectors and sequences</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="interacting-with-r.html"><a href="interacting-with-r.html"><i class="fa fa-check"></i><b>4</b> Interacting with R</a><ul>
<li class="chapter" data-level="4.1" data-path="interacting-with-r.html"><a href="interacting-with-r.html#controlling-r-from-a-script"><i class="fa fa-check"></i><b>4.1</b> Controlling R from a script</a></li>
<li class="chapter" data-level="4.2" data-path="interacting-with-r.html"><a href="interacting-with-r.html#other-editors"><i class="fa fa-check"></i><b>4.2</b> Other editors</a></li>
<li class="chapter" data-level="4.3" data-path="interacting-with-r.html"><a href="interacting-with-r.html#working-with-packages"><i class="fa fa-check"></i><b>4.3</b> Working with packages</a></li>
<li class="chapter" data-level="4.4" data-path="interacting-with-r.html"><a href="interacting-with-r.html#where-your-packages-are-installed"><i class="fa fa-check"></i><b>4.4</b> Where your packages are installed</a></li>
<li class="chapter" data-level="4.5" data-path="interacting-with-r.html"><a href="interacting-with-r.html#reproducible-research"><i class="fa fa-check"></i><b>4.5</b> Reproducible research</a><ul>
<li class="chapter" data-level="4.5.1" data-path="interacting-with-r.html"><a href="interacting-with-r.html#staying-organized"><i class="fa fa-check"></i><b>4.5.1</b> Staying organized</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="interacting-with-r.html"><a href="interacting-with-r.html#easy-organizing"><i class="fa fa-check"></i><b>4.6</b> Easy organizing with RStudio</a><ul>
<li class="chapter" data-level="" data-path="interacting-with-r.html"><a href="interacting-with-r.html#rmarkdown-documents"><i class="fa fa-check"></i>Rmarkdown documents</a></li>
<li class="chapter" data-level="" data-path="interacting-with-r.html"><a href="interacting-with-r.html#externalizing-code"><i class="fa fa-check"></i>Externalizing code</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="interacting-with-r.html"><a href="interacting-with-r.html#displaying-information-about-your-r-session"><i class="fa fa-check"></i><b>4.7</b> Displaying information about your R session</a></li>
<li class="chapter" data-level="4.8" data-path="interacting-with-r.html"><a href="interacting-with-r.html#citing-r-and-r-packages-in-reports-and-papers"><i class="fa fa-check"></i><b>4.8</b> Citing R and R-packages in reports and papers</a></li>
<li class="chapter" data-level="4.9" data-path="interacting-with-r.html"><a href="interacting-with-r.html#exercise-diversity-of-deep-sea-nematodes"><i class="fa fa-check"></i><b>4.9</b> Exercise: diversity of deep-sea nematodes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>5</b> Graphics</a><ul>
<li class="chapter" data-level="5.1" data-path="graphics.html"><a href="graphics.html#the-basics-of-r-graphics"><i class="fa fa-check"></i><b>5.1</b> The basics of R graphics</a></li>
<li class="chapter" data-level="5.2" data-path="graphics.html"><a href="graphics.html#x-y-plots"><i class="fa fa-check"></i><b>5.2</b> X-Y plots</a></li>
<li class="chapter" data-level="5.3" data-path="graphics.html"><a href="graphics.html#histograms"><i class="fa fa-check"></i><b>5.3</b> Histograms</a></li>
<li class="chapter" data-level="5.4" data-path="graphics.html"><a href="graphics.html#boxplots"><i class="fa fa-check"></i><b>5.4</b> Boxplots</a></li>
<li class="chapter" data-level="5.5" data-path="graphics.html"><a href="graphics.html#images-and-contour-plots"><i class="fa fa-check"></i><b>5.5</b> Images and contour plots</a></li>
<li class="chapter" data-level="5.6" data-path="graphics.html"><a href="graphics.html#plotting-a-mathematical-function"><i class="fa fa-check"></i><b>5.6</b> Plotting a mathematical function</a></li>
<li class="chapter" data-level="5.7" data-path="graphics.html"><a href="graphics.html#multiple-figures-in-one-graphical-device"><i class="fa fa-check"></i><b>5.7</b> Multiple figures in one graphical device</a></li>
<li class="chapter" data-level="5.8" data-path="graphics.html"><a href="graphics.html#saving-graphs"><i class="fa fa-check"></i><b>5.8</b> Saving graphs</a></li>
<li class="chapter" data-level="5.9" data-path="graphics.html"><a href="graphics.html#graphical-systems"><i class="fa fa-check"></i><b>5.9</b> Different graphical systems and packages</a></li>
<li class="chapter" data-level="5.10" data-path="graphics.html"><a href="graphics.html#exercises-1"><i class="fa fa-check"></i><b>5.10</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="graphics.html"><a href="graphics.html#simple-curves"><i class="fa fa-check"></i>Simple curves</a></li>
<li class="chapter" data-level="" data-path="graphics.html"><a href="graphics.html#human-population-growth"><i class="fa fa-check"></i>Human population growth</a></li>
<li class="chapter" data-level="" data-path="graphics.html"><a href="graphics.html#toxic-ammonia"><i class="fa fa-check"></i>Toxic ammonia</a></li>
<li class="chapter" data-level="" data-path="graphics.html"><a href="graphics.html#the-iris-data-set"><i class="fa fa-check"></i>The iris data set</a></li>
<li><a href="graphics.html#automatic-coercion-by-plot">Automatic coercion by <code>plot()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="file-io.html"><a href="file-io.html"><i class="fa fa-check"></i><b>6</b> File input and output</a><ul>
<li class="chapter" data-level="6.1" data-path="file-io.html"><a href="file-io.html#defining-the-path-to-a-file-or-directory"><i class="fa fa-check"></i><b>6.1</b> Defining the path to a file or directory</a></li>
<li class="chapter" data-level="6.2" data-path="file-io.html"><a href="file-io.html#the-working-directory"><i class="fa fa-check"></i><b>6.2</b> The “working directory”</a></li>
<li class="chapter" data-level="6.3" data-path="file-io.html"><a href="file-io.html#using-the-read.table-and-write.table-functions"><i class="fa fa-check"></i><b>6.3</b> Using the <code>read.table</code> and <code>write.table</code> functions</a></li>
<li class="chapter" data-level="6.4" data-path="file-io.html"><a href="file-io.html#reading-data-from-a-webserver"><i class="fa fa-check"></i><b>6.4</b> Reading data from a webserver</a></li>
<li class="chapter" data-level="6.5" data-path="file-io.html"><a href="file-io.html#reading-data-from-compressed-files-and-archives"><i class="fa fa-check"></i><b>6.5</b> Reading data from compressed files and archives</a></li>
<li class="chapter" data-level="6.6" data-path="file-io.html"><a href="file-io.html#inputoutput-with-excel-files-and-database-management-systems"><i class="fa fa-check"></i><b>6.6</b> Input/output with Excel files and database management systems</a></li>
<li class="chapter" data-level="6.7" data-path="file-io.html"><a href="file-io.html#exercises-2"><i class="fa fa-check"></i><b>6.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Programming-with-R.html"><a href="Programming-with-R.html"><i class="fa fa-check"></i><b>7</b> Programming with R</a><ul>
<li class="chapter" data-level="7.1" data-path="Programming-with-R.html"><a href="Programming-with-R.html#defining-a-function"><i class="fa fa-check"></i><b>7.1</b> Defining a function</a></li>
<li class="chapter" data-level="7.2" data-path="Programming-with-R.html"><a href="Programming-with-R.html#program-flow-control"><i class="fa fa-check"></i><b>7.2</b> Program flow control</a></li>
<li class="chapter" data-level="7.3" data-path="Programming-with-R.html"><a href="Programming-with-R.html#literature"><i class="fa fa-check"></i><b>7.3</b> Literature</a></li>
<li class="chapter" data-level="7.4" data-path="Programming-with-R.html"><a href="Programming-with-R.html#exercises-3"><i class="fa fa-check"></i><b>7.4</b> Exercises</a><ul>
<li class="chapter" data-level="7.4.1" data-path="Programming-with-R.html"><a href="Programming-with-R.html#programming-loops"><i class="fa fa-check"></i><b>7.4.1</b> Loops</a></li>
<li class="chapter" data-level="" data-path="Programming-with-R.html"><a href="Programming-with-R.html#diversity-of-deep-sea-nematodes"><i class="fa fa-check"></i>Diversity of deep-sea nematodes</a></li>
<li class="chapter" data-level="" data-path="Programming-with-R.html"><a href="Programming-with-R.html#diversity-indices-a-function-optional"><i class="fa fa-check"></i>Diversity indices – a function (optional)</a></li>
<li class="chapter" data-level="" data-path="Programming-with-R.html"><a href="Programming-with-R.html#rarefaction-diversity-optional"><i class="fa fa-check"></i>Rarefaction diversity (optional)</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="Programming-with-R.html"><a href="Programming-with-R.html#add-prog-ex"><i class="fa fa-check"></i><b>7.5</b> Additional programming exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="vectorization.html"><a href="vectorization.html"><i class="fa fa-check"></i><b>8</b> Vectorization</a><ul>
<li class="chapter" data-level="8.1" data-path="vectorization.html"><a href="vectorization.html#the-function-apply"><i class="fa fa-check"></i><b>8.1</b> The function <code>apply()</code></a></li>
<li class="chapter" data-level="8.2" data-path="vectorization.html"><a href="vectorization.html#the-function-tapply"><i class="fa fa-check"></i><b>8.2</b> The function <code id="the-function-tapply">tapply()</code></a></li>
<li class="chapter" data-level="8.3" data-path="vectorization.html"><a href="vectorization.html#the-functions-lapply-and-sapply"><i class="fa fa-check"></i><b>8.3</b> The functions <code>lapply()</code> and <code>sapply()</code></a></li>
<li class="chapter" data-level="8.4" data-path="vectorization.html"><a href="vectorization.html#exercises-4"><i class="fa fa-check"></i><b>8.4</b> Exercises</a><ul>
<li class="chapter" data-level="8.4.1" data-path="vectorization.html"><a href="vectorization.html#permutation-function"><i class="fa fa-check"></i><b>8.4.1</b> A permutation function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="reshaping.html"><a href="reshaping.html"><i class="fa fa-check"></i><b>9</b> Reshaping and manipulating complex data</a><ul>
<li class="chapter" data-level="9.1" data-path="reshaping.html"><a href="reshaping.html#the-tidyr-package"><i class="fa fa-check"></i><b>9.1</b> The <code>tidyr</code> package</a></li>
<li class="chapter" data-level="9.2" data-path="reshaping.html"><a href="reshaping.html#the-dplyr-package"><i class="fa fa-check"></i><b>9.2</b> The <code>dplyr</code> package</a></li>
<li class="chapter" data-level="9.3" data-path="reshaping.html"><a href="reshaping.html#exercises-5"><i class="fa fa-check"></i><b>9.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="formulasyntax.html"><a href="formulasyntax.html"><i class="fa fa-check"></i><b>10</b> Using formula syntax</a><ul>
<li class="chapter" data-level="10.1" data-path="formulasyntax.html"><a href="formulasyntax.html#using-formula-syntax-in-plotting"><i class="fa fa-check"></i><b>10.1</b> Using formula syntax in plotting</a></li>
<li class="chapter" data-level="10.2" data-path="formulasyntax.html"><a href="formulasyntax.html#using-formula-syntax-in-model-definition"><i class="fa fa-check"></i><b>10.2</b> Using formula syntax in model definition</a><ul>
<li class="chapter" data-level="10.2.1" data-path="formulasyntax.html"><a href="formulasyntax.html#data-with-a-continuous-explanatory-variable"><i class="fa fa-check"></i><b>10.2.1</b> Data with a continuous explanatory variable</a></li>
<li class="chapter" data-level="10.2.2" data-path="formulasyntax.html"><a href="formulasyntax.html#data-with-two-discrete-explanatory-variables-factors"><i class="fa fa-check"></i><b>10.2.2</b> Data with two discrete explanatory variables (factors)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Applications</b></span></li>
<li class="chapter" data-level="11" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>11</b> The carnival of distributions</a><ul>
<li class="chapter" data-level="11.1" data-path="distributions.html"><a href="distributions.html#distribution-functions"><i class="fa fa-check"></i><b>11.1</b> Distribution functions</a></li>
<li class="chapter" data-level="11.2" data-path="distributions.html"><a href="distributions.html#distribution-functions-in-r"><i class="fa fa-check"></i><b>11.2</b> Distribution functions in R</a></li>
<li class="chapter" data-level="11.3" data-path="distributions.html"><a href="distributions.html#the-exponential-and-poisson-distributions"><i class="fa fa-check"></i><b>11.3</b> The exponential and Poisson distributions</a><ul>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#exercises-6"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="distributions.html"><a href="distributions.html#the-bernoulli-and-binomial-distributions"><i class="fa fa-check"></i><b>11.4</b> The Bernoulli and binomial distributions</a><ul>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#exercises-7"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="distributions.html"><a href="distributions.html#the-normal-and-standard-normal-distribution"><i class="fa fa-check"></i><b>11.5</b> The normal and standard normal distribution</a><ul>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="distributions.html"><a href="distributions.html#students-t-distribution"><i class="fa fa-check"></i><b>11.6</b> Student’s t-distribution</a><ul>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="distributions.html"><a href="distributions.html#the-chi-squared-distribution"><i class="fa fa-check"></i><b>11.7</b> The chi-squared distribution</a><ul>
<li class="chapter" data-level="11.7.1" data-path="distributions.html"><a href="distributions.html#application-in-pearsons-chi-square-goodness-of-fit-test"><i class="fa fa-check"></i><b>11.7.1</b> Application in Pearson’s chi-square goodness of fit test</a></li>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#exercise-2"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11.8" data-path="distributions.html"><a href="distributions.html#the-f-distribution"><i class="fa fa-check"></i><b>11.8</b> The F-distribution</a><ul>
<li class="chapter" data-level="11.8.1" data-path="distributions.html"><a href="distributions.html#analysis-of-variance"><i class="fa fa-check"></i><b>11.8.1</b> Analysis of variance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="linearmodels.html"><a href="linearmodels.html"><i class="fa fa-check"></i><b>12</b> Linear models and ANOVA</a><ul>
<li class="chapter" data-level="12.1" data-path="linearmodels.html"><a href="linearmodels.html#modeling-with-factor-type-predictor-variables"><i class="fa fa-check"></i><b>12.1</b> Modeling with factor-type predictor variables</a><ul>
<li class="chapter" data-level="12.1.1" data-path="linearmodels.html"><a href="linearmodels.html#alternative-dummy-variable-coding-schemes"><i class="fa fa-check"></i><b>12.1.1</b> Alternative dummy variable coding schemes</a></li>
<li class="chapter" data-level="" data-path="linearmodels.html"><a href="linearmodels.html#exercises-8"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="linearmodels.html"><a href="linearmodels.html#two-way-anovafactorial-anova"><i class="fa fa-check"></i><b>12.2</b> Two-way ANOVA/factorial ANOVA</a><ul>
<li class="chapter" data-level="12.2.1" data-path="linearmodels.html"><a href="linearmodels.html#unbalanced-data"><i class="fa fa-check"></i><b>12.2.1</b> Unbalanced data</a></li>
<li class="chapter" data-level="" data-path="linearmodels.html"><a href="linearmodels.html#exercise-5"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="linearmodels.html"><a href="linearmodels.html#combinations-of-numerical-and-discrete-predictors"><i class="fa fa-check"></i><b>12.3</b> Combinations of numerical and discrete predictors</a><ul>
<li class="chapter" data-level="" data-path="linearmodels.html"><a href="linearmodels.html#exercises-9"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="linearmodels.html"><a href="linearmodels.html#the-connection-between-linear-models-and-anova"><i class="fa fa-check"></i><b>12.4</b> The connection between linear models and ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="hubble.html"><a href="hubble.html"><i class="fa fa-check"></i><b>13</b> The age of the universe</a><ul>
<li class="chapter" data-level="13.1" data-path="hubble.html"><a href="hubble.html#exercises-10"><i class="fa fa-check"></i><b>13.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="datafabrication.html"><a href="datafabrication.html"><i class="fa fa-check"></i><b>14</b> A case of data fabrication</a><ul>
<li class="chapter" data-level="14.1" data-path="datafabrication.html"><a href="datafabrication.html#exercises-11"><i class="fa fa-check"></i><b>14.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="amt-carrier.html"><a href="amt-carrier.html"><i class="fa fa-check"></i><b>15</b> A critical evaluation of ammonium transporter kinetics</a><ul>
<li class="chapter" data-level="15.1" data-path="amt-carrier.html"><a href="amt-carrier.html#exercises-12"><i class="fa fa-check"></i><b>15.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="bias-metabolomics.html"><a href="bias-metabolomics.html"><i class="fa fa-check"></i><b>16</b> Bias in metabolomics data</a><ul>
<li class="chapter" data-level="16.1" data-path="bias-metabolomics.html"><a href="bias-metabolomics.html#exercises-13"><i class="fa fa-check"></i><b>16.1</b> Exercises</a><ul>
<li class="chapter" data-level="16.1.1" data-path="bias-metabolomics.html"><a href="bias-metabolomics.html#an-alternative-solution-generalized-additive-modeling-optional"><i class="fa fa-check"></i><b>16.1.1</b> An alternative solution: Generalized additive modeling (optional)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="nerve-fiber.html"><a href="nerve-fiber.html"><i class="fa fa-check"></i><b>17</b> Correlation between fiber density and episodic memory?</a><ul>
<li class="chapter" data-level="17.1" data-path="nerve-fiber.html"><a href="nerve-fiber.html#exercises-14"><i class="fa fa-check"></i><b>17.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="classifiers.html"><a href="classifiers.html"><i class="fa fa-check"></i><b>18</b> Logistic regression</a><ul>
<li class="chapter" data-level="18.1" data-path="classifiers.html"><a href="classifiers.html#classifiers"><i class="fa fa-check"></i><b>18.1</b> Classifiers</a></li>
<li class="chapter" data-level="18.2" data-path="classifiers.html"><a href="classifiers.html#logistic-regression"><i class="fa fa-check"></i><b>18.2</b> Logistic regression</a><ul>
<li class="chapter" data-level="18.2.1" data-path="classifiers.html"><a href="classifiers.html#logistic-regression-a-case-of-generalized-linear-modeling"><i class="fa fa-check"></i><b>18.2.1</b> Logistic Regression: a case of Generalized Linear Modeling</a></li>
<li class="chapter" data-level="18.2.2" data-path="classifiers.html"><a href="classifiers.html#logistic-regression-in-r"><i class="fa fa-check"></i><b>18.2.2</b> Logistic regression in R</a></li>
<li class="chapter" data-level="18.2.3" data-path="classifiers.html"><a href="classifiers.html#exercises-15"><i class="fa fa-check"></i><b>18.2.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="class-dairy-strains.html"><a href="class-dairy-strains.html"><i class="fa fa-check"></i><b>19</b> Classification of dairy bacteria</a><ul>
<li class="chapter" data-level="19.1" data-path="class-dairy-strains.html"><a href="class-dairy-strains.html#exercises-16"><i class="fa fa-check"></i><b>19.1</b> Exercises</a><ul>
<li class="chapter" data-level="19.1.1" data-path="class-dairy-strains.html"><a href="class-dairy-strains.html#description-of-the-data"><i class="fa fa-check"></i><b>19.1.1</b> Description of the data</a></li>
<li class="chapter" data-level="19.1.2" data-path="class-dairy-strains.html"><a href="class-dairy-strains.html#data-conversion"><i class="fa fa-check"></i><b>19.1.2</b> Data conversion</a></li>
<li class="chapter" data-level="19.1.3" data-path="class-dairy-strains.html"><a href="class-dairy-strains.html#data-analysis"><i class="fa fa-check"></i><b>19.1.3</b> Data analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="naivebayes.html"><a href="naivebayes.html"><i class="fa fa-check"></i><b>20</b> Naïve Bayes classifiers</a><ul>
<li class="chapter" data-level="20.1" data-path="naivebayes.html"><a href="naivebayes.html#the-naive-bayes-classifier"><i class="fa fa-check"></i><b>20.1</b> The Naive Bayes classifier</a></li>
<li class="chapter" data-level="20.2" data-path="naivebayes.html"><a href="naivebayes.html#a-crime-scene"><i class="fa fa-check"></i><b>20.2</b> A crime scene</a></li>
<li class="chapter" data-level="20.3" data-path="naivebayes.html"><a href="naivebayes.html#reconstructing-bayes-lawtheorem"><i class="fa fa-check"></i><b>20.3</b> Reconstructing Bayes law/theorem</a></li>
<li class="chapter" data-level="20.4" data-path="naivebayes.html"><a href="naivebayes.html#deciding-on-the-class"><i class="fa fa-check"></i><b>20.4</b> Deciding on the class</a></li>
<li class="chapter" data-level="20.5" data-path="naivebayes.html"><a href="naivebayes.html#continuous-predicting-variables"><i class="fa fa-check"></i><b>20.5</b> Continuous predicting variables</a></li>
<li class="chapter" data-level="20.6" data-path="naivebayes.html"><a href="naivebayes.html#combining-information-from-different-predictor-variables"><i class="fa fa-check"></i><b>20.6</b> Combining information from different predictor variables</a></li>
<li class="chapter" data-level="20.7" data-path="naivebayes.html"><a href="naivebayes.html#exercises-17"><i class="fa fa-check"></i><b>20.7</b> Exercises</a><ul>
<li class="chapter" data-level="20.7.1" data-path="naivebayes.html"><a href="naivebayes.html#predicting-iris-species"><i class="fa fa-check"></i><b>20.7.1</b> Predicting iris species</a></li>
<li class="chapter" data-level="20.7.2" data-path="naivebayes.html"><a href="naivebayes.html#predicting-income"><i class="fa fa-check"></i><b>20.7.2</b> Predicting income</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="resampling-techniques.html"><a href="resampling-techniques.html"><i class="fa fa-check"></i><b>21</b> Resampling techniques</a><ul>
<li class="chapter" data-level="21.1" data-path="resampling-techniques.html"><a href="resampling-techniques.html#bootstrapping"><i class="fa fa-check"></i><b>21.1</b> Bootstrapping</a></li>
<li class="chapter" data-level="21.2" data-path="resampling-techniques.html"><a href="resampling-techniques.html#exercises-18"><i class="fa fa-check"></i><b>21.2</b> Exercises</a><ul>
<li class="chapter" data-level="21.2.1" data-path="resampling-techniques.html"><a href="resampling-techniques.html#medical-patches"><i class="fa fa-check"></i><b>21.2.1</b> Medical patches</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="resampling-techniques.html"><a href="resampling-techniques.html#permutation-test"><i class="fa fa-check"></i><b>21.3</b> Permutation test</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="numerical-differentiation.html"><a href="numerical-differentiation.html"><i class="fa fa-check"></i><b>22</b> Numerical differentiation and smoothing</a><ul>
<li class="chapter" data-level="22.1" data-path="numerical-differentiation.html"><a href="numerical-differentiation.html#exercises-19"><i class="fa fa-check"></i><b>22.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="randomnumbers.html"><a href="randomnumbers.html"><i class="fa fa-check"></i><b>23</b> Random numbers</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bias-metabolomics" class="section level1">
<h1><span class="header-section-number">CHAPTER 16</span> Bias in metabolomics data</h1>
<p><strong>(Techniques: data de-trending, generalized additive modelling)</strong></p>
<p>The current case is one demonstrating the importance of measuring and saving as many variables as possible, even the ones that you think will not matter.</p>
<p>In an experiment the production of flavour compounds by 10 strains of <em>Lactococcus lactis</em> strains was measured in 20 experimental microcheeses for each strain. The flavour compounds were measured with a mass-spectrometer coupled to a gas-chromatograph. The researcher was particularly interested in differences in the production of propanol, since there were earlier indications that this characteristic should differ significantly between strains.</p>
<p>The data are present in the tab-delimited file <a href="data/metabolomics/propanol_production.txt">data/metabolomics/propanol_production.txt</a>. The file contains a header, a column called “strain” with sample names, a column stating whether the sample was a calibration point or of an unknown concentration, identified as “calibration” or “sample”, and a column with the raw propanol signals from the GC-MS system. The calibration samples contained either 0, 2, 5 or 10 <span class="math inline">\(\mu M\)</span> propanol, indicated by the sample name. The order of the samples was block-randomized, <em>i.e.</em> each block of 14 samples (10 cheeses and 4 calibration samples) was randomized.</p>
<p>The researcher comes to you with the following plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">file.path</span>(baseurl, <span class="st">&#39;data&#39;</span>, <span class="st">&#39;metabolomics&#39;</span>, <span class="st">&#39;propanol_production.txt&#39;</span>), <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</code></pre></div>
<p><img src="StatR_files/figure-html/biasmetabol_01-1.png" width="80%" /></p>
<p>She was disappointed to see that the differences between the strains were hardly, if at all, measurable. Furthermore, the calibration curves looked awful, containing extremely high variance. So, she comes to you and asks what could be wrong with the measurements. Your task is to explore the data, try to correct its main defect and present a more encouraging result to her, with more accurate concentration data.</p>
<div id="exercises-13" class="section level2">
<h2><span class="header-section-number">16.1</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>Start by loading the data in a data frame, study its structure, and reproduce exactly the plots above. Use the formula syntax in the <code>boxplot()</code> and <code>plot()</code> commands.
<div>
<a id="BiasMetabHead1" href="javascript:toggle('BiasMetabSol1','BiasMetabHead1');" >Show solution</a>
</div>
<div id="BiasMetabSol1" style="display: none">
<p>Loading the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">file.path</span>(baseurl, <span class="st">&#39;data&#39;</span>, <span class="st">&#39;metabolomics&#39;</span>, <span class="st">&#39;propanol_production.txt&#39;</span>), <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</code></pre></div>
<p>and displaying the first few lines</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(d)</code></pre></div>
<pre><code>##   samplenr  strain  sampletype rawpropanol
## 1        1 strainG      sample       123.5
## 2        2    cal5 calibration        99.6
## 3        3 strainB      sample       155.1
## 4        4 strainF      sample       149.1
## 5        5 strainE      sample        99.6
## 6        6   cal10 calibration       205.8</code></pre>
<p>shows that we need to provide a new column that contains the concentration of propanol in the calibration samples. And let’s make it equal to <code>NA</code> in the cheese samples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d<span class="op">$</span>concentration &lt;-<span class="st"> </span><span class="kw">ifelse</span>(d<span class="op">$</span>sampletype<span class="op">==</span><span class="st">&#39;calibration&#39;</span>,<span class="dv">0</span>,<span class="ot">NA</span>)
d<span class="op">$</span>concentration[d<span class="op">$</span>strain<span class="op">==</span><span class="st">&#39;cal2&#39;</span>] &lt;-<span class="st"> </span><span class="dv">2</span>
d<span class="op">$</span>concentration[d<span class="op">$</span>strain<span class="op">==</span><span class="st">&#39;cal5&#39;</span>] &lt;-<span class="st"> </span><span class="dv">5</span>
d<span class="op">$</span>concentration[d<span class="op">$</span>strain<span class="op">==</span><span class="st">&#39;cal10&#39;</span>] &lt;-<span class="st"> </span><span class="dv">10</span></code></pre></div>
<p>To reproduce the plots it is most convenient to split the data in two data frames, one with the calibration data and another with the cheese data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cheese &lt;-<span class="st"> </span>d[d<span class="op">$</span>sampletype<span class="op">==</span><span class="st">&#39;sample&#39;</span>,]
calibrations &lt;-<span class="st"> </span>d[d<span class="op">$</span>sampletype<span class="op">==</span><span class="st">&#39;calibration&#39;</span>,]</code></pre></div>
<p>If we would now make the boxplot, we would get a plot that contains also the calibration sample levels (try it). Although these are not present any more in the <code>cheese</code> data frame, a sub-selection of a factor type vector leaves all the original levels in that derived factor vector. To remove the unused levels, we use the <code>droplevels()</code> function. We are then able to reproduce the plots above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cheese<span class="op">$</span>strain &lt;-<span class="st"> </span><span class="kw">droplevels</span>(cheese<span class="op">$</span>strain)
<span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dt">ncol=</span><span class="dv">2</span>))
<span class="kw">plot</span>(rawpropanol<span class="op">~</span>concentration, <span class="dt">data=</span>calibrations, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">xlab=</span><span class="st">&#39;Propanol [microM]&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;Raw propanol signal&#39;</span>)
<span class="kw">boxplot</span>(rawpropanol<span class="op">~</span>strain, <span class="dt">data=</span>cheese, <span class="dt">col=</span><span class="st">&#39;grey&#39;</span>, <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">ylab=</span><span class="st">&#39;Raw propanol signal&#39;</span>)</code></pre></div>
<p><img src="StatR_files/figure-html/biasmetabol_05-1.png" width="0.8\linewidth" /></p>
</div></li>
<li>Explore the data using the <code>plot()</code> method of the <strong>data frame</strong> class. Do you notice the unexpected correlation?
<div>
<a id="BiasMetabHead2" href="javascript:toggle('BiasMetabSol2','BiasMetabHead2');" >Show solution</a>
</div>
<div id="BiasMetabSol2" style="display: none">
<p>We are now ready to explore the data. If the data frame does not contain too many columns, a pairplot can be produced to detect correlations by just using the <code>plot()</code> method of the <strong>data frame</strong> class. Doing that (yourself!), you will see that there is an unexpected relation between the sample number and the raw propanol measurement. Such a correlation is not expected, because the cheese and calibration samples are measured in blocked random order. Apparently, there is a large instrument-trend present in the data, and the raw measurement seems to increase with time. A cause could be that the GC-MS apparatus was not properly equilibrated. Whatever the cause, we would like to know whether we can still extract the desired information (differences in propanol concentrations between strains) out of the data, even if it were only to encourage the researcher that putting more effort in solving the technical problems with the GC-MS will pay off.</p>
</div></li>
<li>Re-create a single plot with the unexpected correlation. Give each strain/concentration a different symbol or color. What do you notice? What does this mean for the possibility of filtering out the trend?
<div>
<a id="BiasMetabHead3" href="javascript:toggle('BiasMetabSol3','BiasMetabHead3');" >Show solution</a>
</div>
<div id="BiasMetabSol3" style="display: none">
<p>As a first attempt, we plot the raw propanol data as a function of the sample number, but using different symbols and colors for each of the strains. We use the original data frame including the calibration data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rawpropanol<span class="op">~</span>samplenr, <span class="dt">data=</span>d, <span class="dt">col=</span>d<span class="op">$</span>strain, <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">19</span>)[(<span class="kw">as.numeric</span>(d<span class="op">$</span>strain)<span class="op">%%</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>])</code></pre></div>
<p><img src="StatR_files/figure-html/biasmetabol_06-1.png" width="672" /></p>
<p>This looks encouraging, because we see that locally, <em>i.e.</em> when comparing samples close to each other, the differences between the sample types seems to be more significant than globally. So, perhaps we could correct the defect by fitting a trend line through the data, and be subtracting this trend line from each of the points.</p>
</div></li>
<li>Use the <code>loess()</code> function to create a trend line through the data. Test a few different values for the span parameter of this function. Plot these trend lines in the previous graph (without different symbols for different data types).
<div>
<a id="BiasMetabHead4" href="javascript:toggle('BiasMetabSol4','BiasMetabHead4');" >Show solution</a>
</div>
<div id="BiasMetabSol4" style="display: none">
<p>A general trend line, whose precise shape we do not know, can be conveniently estimated using the <code>loess()</code> function in R. Take a look at the help file of this function to understand what it does.</p>
<p>The <code>loess()</code> function contains a parameter “span” that affects the smoothness of the fit. So, let us make a few loess fits with different values for the span parameter, and plot these in the previous figure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rawpropanol<span class="op">~</span>samplenr, <span class="dt">data=</span>d, <span class="dt">cex=</span><span class="fl">0.6</span>)
trend1 &lt;-<span class="st"> </span><span class="kw">loess</span>(rawpropanol<span class="op">~</span>samplenr, <span class="dt">data=</span>d, <span class="dt">span=</span><span class="fl">0.35</span>)
trend2 &lt;-<span class="st"> </span><span class="kw">loess</span>(rawpropanol<span class="op">~</span>samplenr, <span class="dt">data=</span>d, <span class="dt">span=</span><span class="fl">0.75</span>)
trend3 &lt;-<span class="st"> </span><span class="kw">loess</span>(rawpropanol<span class="op">~</span>samplenr, <span class="dt">data=</span>d, <span class="dt">span=</span><span class="fl">1.5</span>)
<span class="kw">lines</span>(<span class="kw">predict</span>(trend3), <span class="dt">col=</span><span class="st">&#39;blue&#39;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">lines</span>(<span class="kw">predict</span>(trend2), <span class="dt">col=</span><span class="st">&#39;green&#39;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">lines</span>(<span class="kw">predict</span>(trend1), <span class="dt">col=</span><span class="st">&#39;red&#39;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">legend</span>(<span class="st">&#39;bottomright&#39;</span>,<span class="kw">c</span>(<span class="st">&#39;span=0.35&#39;</span>,<span class="st">&#39;span=0.75&#39;</span>,<span class="st">&#39;span=1.5&#39;</span>), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;green&#39;</span>,<span class="st">&#39;blue&#39;</span>))</code></pre></div>
<p><img src="StatR_files/figure-html/biasmetabol_07-1.png" width="672" /></p>
</div></li>
<li>Use the trend line to correct the original data. Re-create the calibration and boxplot figures with the corrected data. Does it look better than the original data? Is there evidence for a residual trend in the corrected data?
<div>
<a id="BiasMetabHead5" href="javascript:toggle('BiasMetabSol5','BiasMetabHead5');" >Show solution</a>
</div>
<div id="BiasMetabSol5" style="display: none">
<p>Let’s choose the smoothest trend line to subtract the trend, put the result in a column “corrawprop”, split the data in two data frames again and then reproduce the boxplot and calibration plot using the corrected data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d<span class="op">$</span>corrawprop &lt;-<span class="st"> </span>d<span class="op">$</span>rawpropanol <span class="op">-</span><span class="st"> </span><span class="kw">predict</span>(trend3)
cheese &lt;-<span class="st"> </span>d[d<span class="op">$</span>sampletype<span class="op">==</span><span class="st">&#39;sample&#39;</span>,]
cheese<span class="op">$</span>strain &lt;-<span class="st"> </span><span class="kw">droplevels</span>(cheese<span class="op">$</span>strain)
calibrations &lt;-<span class="st"> </span>d[d<span class="op">$</span>sampletype<span class="op">==</span><span class="st">&#39;calibration&#39;</span>,]
<span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dt">ncol=</span><span class="dv">2</span>))
<span class="kw">plot</span>(corrawprop<span class="op">~</span>concentration,<span class="dt">data=</span>calibrations,<span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">xlab=</span><span class="st">&#39;Propanol [microM]&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;Raw propanol signal&#39;</span>)
<span class="kw">boxplot</span>(corrawprop<span class="op">~</span>strain, <span class="dt">data=</span>cheese, <span class="dt">col=</span><span class="st">&#39;grey&#39;</span>, <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">ylab=</span><span class="st">&#39;Raw propanol signal&#39;</span>)</code></pre></div>
<p><img src="StatR_files/figure-html/biasmetabol_08-1.png" width="0.8\linewidth" /></p>
<p>A large part of the variance in the data due to the global trend has been removed. We should check whether we can still detect a residual trend in the corrected data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(corrawprop<span class="op">~</span>samplenr,<span class="dt">data=</span>d)</code></pre></div>
<p><img src="StatR_files/figure-html/biasmetabol_09-1.png" width="672" /> That doesn’t seem to be the case.</p>
</div></li>
<li>Using a linear fit through the calibration data, calculate the propanol concentrations in the cheeses. Make a plot of the calibration data with the fitted curve, and make boxplots of the propanol concentrations in the different cheeses.
<div>
<a id="BiasMetabHead6" href="javascript:toggle('BiasMetabSol6','BiasMetabHead6');" >Show solution</a>
</div>
<div id="BiasMetabSol6" style="display: none">
<p>To obtain propanol concentrations instead of trend-corrected raw data, we make a linear fit of the calibration data using the <code>lm()</code> function, and use this fit together with its <code>predict()</code> method to calculate the unknown sample concentrations (look up the help page of <code>predict.lm()</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">calibfit &lt;-<span class="st"> </span><span class="kw">lm</span>(concentration<span class="op">~</span>corrawprop, <span class="dt">data=</span>calibrations)
cheese<span class="op">$</span>fittedconc &lt;-<span class="st"> </span><span class="kw">predict</span>(calibfit, <span class="dt">newdata=</span>cheese)
<span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dt">ncol=</span><span class="dv">2</span>))
<span class="kw">plot</span>(corrawprop<span class="op">~</span>concentration,<span class="dt">data=</span>calibrations,<span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">xlab=</span><span class="st">&#39;Propanol [microM]&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;Raw propanol signal&#39;</span>, <span class="dt">main=</span><span class="st">&#39;Calibration&#39;</span>)
<span class="kw">lines</span>(<span class="kw">predict</span>(calibfit),calibrations<span class="op">$</span>corrawprop, <span class="dt">col=</span><span class="st">&#39;red&#39;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">boxplot</span>(fittedconc<span class="op">~</span>strain, <span class="dt">data=</span>cheese, <span class="dt">col=</span><span class="st">&#39;grey&#39;</span>, <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">ylab=</span><span class="st">&#39;Propanol [microM]&#39;</span>,<span class="dt">main=</span><span class="st">&#39;Deduced concentrations&#39;</span>)</code></pre></div>
<p><img src="StatR_files/figure-html/biasmetabol_10-1.png" width="0.8\linewidth" /></p>
<p>I leave it up to you to produce a table with means and standard deviations for the propanol concentrations produced per strain.</p>
</div></li>
<li>Why was the experimental design chosen by the scientist a good design? Which design would not have allowed us to correct the trend and calculate the propanol concentrations?
<div>
<a id="BiasMetabHead7" href="javascript:toggle('BiasMetabSol7','BiasMetabHead7');" >Show solution</a>
</div>
<div id="BiasMetabSol7" style="display: none">
<p>With the current insight we can say that the researcher was very lucky to choose the block-randomized experimental design. Suppose she had measured all calibration samples first and then each strain 20 times in a row. Would we have been able to correct for the bias caused by the trend? This is a good lesson: randomized or designs with repeated blocks designs are always better than extremely regular designs. The latter designs always bear the danger of mixing in effects from unknown factors, like in this case a time dependent trend, which can during data analysis not be separated from the information that we are interested in.</p>
</div></li>
</ol>
<div id="an-alternative-solution-generalized-additive-modeling-optional" class="section level3">
<h3><span class="header-section-number">16.1.1</span> An alternative solution: Generalized additive modeling (optional)</h3>
<p>There is a modern branch of statistical modeling called generalized additive modeling (GAM, see <span class="citation">Wood (<a href="#ref-Wood2006">2006</a>)</span>) that is able to model data as sums of smooth functions of co-variates (continuous, or at least ordered explanatory variables) and of factor level coefficients. In principle, the problem above is of that type. The raw propanol readings are the sum of the trend, which we assume is a smooth function of the sample number, and of the sample class. GAM modeling has been implemented in R in the package “mgcv”, which is part of a standard R installation. The advantage of using such an approach relative to the 2-stage approach that we used above, being first estimation of the trend and correction of the data, and subsequent estimation of the sample averages is that the data are fitted in one operation. In principle this leads to more accurate results. This is especially true if the number of measurements is much smaller than we had above.</p>
<ol style="list-style-type: decimal">
<li>If you feel inspired then try to solve the problem using this method. Read the details of the <code>gam</code> fitting function in its extensive help document.
<div>
<a id="BiasMetabHead8" href="javascript:toggle('BiasMetabSol8','BiasMetabHead8');" >Show solution</a>
</div>
<div id="BiasMetabSol8" style="display: none">
<p>The problem is solved using GAM. The key is to realize that the gam functions “know” a new kind of term in the modeling formula, namely <code>s(v)</code>, which stands for some smooth function of the variable <code>v</code>. Here we use <code>s(samplenr)</code> to model an arbitrary but smooth function of the variable <code>samplenr</code>. This function will represent the instrument-trend in the data. The other term in the model formula will be a constant that depends on the “strain” factor. This factor includes the calibration samples, and should perhaps actually have been called “sample.class”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># library(mgcv)</span>
gamfit &lt;-<span class="st"> </span><span class="kw">gam</span>(rawpropanol<span class="op">~</span><span class="kw">s</span>(samplenr)<span class="op">+</span>strain, <span class="dt">data=</span>d)</code></pre></div>
<p>This gives us a “gam” object containing, among other information, the fit. The details of the <code>plot()</code> method of the gam class can be found under “plot.gam()”. If we apply it we get the following graph</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(gamfit,<span class="dt">rug=</span><span class="ot">FALSE</span>,<span class="dt">residuals=</span><span class="ot">TRUE</span>,<span class="dt">pch=</span><span class="dv">1</span>,<span class="dt">cex=</span><span class="fl">0.5</span>)</code></pre></div>
<p><img src="StatR_files/figure-html/biasmetabol_12-1.png" width="672" /></p>
<p>The smooth line shows the fitted trend, and an estimated region of <span class="math inline">\(\pm\)</span> one standard error of this fitted trend. The points show the residuals excluding sample class (strain) effects (so the true residuals). The trend looks quite similar to the loess fit above. We are interested in the trend-filtered data because we still have to calculate propanol concentrations using the calibration data. We can reconstruct these by setting the <code>type='terms'</code> argument of the <code>predict()</code> method for gam objects. This will yield a matrix showing per column the contribution of each of the predictive variables to the final predicted value. Since this would give each sample from a sample class the same value we still have to add the residuals to reconstruct the trend-filtered values. Let’s call these values “gamrawprop”, and let’s make the same two graphs again</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d<span class="op">$</span>gamrawprop &lt;-<span class="st"> </span><span class="kw">predict</span>(gamfit, <span class="dt">type=</span><span class="st">&#39;terms&#39;</span>)[,<span class="st">&#39;strain&#39;</span>]<span class="op">+</span><span class="kw">residuals</span>(gamfit)
cheese &lt;-<span class="st"> </span>d[d<span class="op">$</span>sampletype<span class="op">==</span><span class="st">&#39;sample&#39;</span>,]
cheese<span class="op">$</span>strain &lt;-<span class="st"> </span><span class="kw">droplevels</span>(cheese<span class="op">$</span>strain)
calibrations &lt;-<span class="st"> </span>d[d<span class="op">$</span>sampletype<span class="op">==</span><span class="st">&#39;calibration&#39;</span>,]
<span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dt">ncol=</span><span class="dv">2</span>))
<span class="kw">plot</span>(gamrawprop<span class="op">~</span>concentration,<span class="dt">data=</span>calibrations,<span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">xlab=</span><span class="st">&#39;Propanol [microM]&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;GAM corrected propanol signal&#39;</span>)
<span class="kw">boxplot</span>(gamrawprop<span class="op">~</span>strain, <span class="dt">data=</span>cheese, <span class="dt">col=</span><span class="st">&#39;grey&#39;</span>, <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">ylab=</span><span class="st">&#39;GAM corrected propanol signal&#39;</span>)</code></pre></div>
<p><img src="StatR_files/figure-html/biasmetabol_13-1.png" width="0.8\linewidth" /></p>
<p>Except for a difference in offset, this looks quite similar to what we obtained using our two-stage method.</p>
</div></li>
</ol>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Wood2006">
<p>Wood, S. N. 2006. <em>Generalized Additive Models. An Introduction with R</em>. Boca Raton, FL, USA: Chapman &amp; Hall/CRC.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="amt-carrier.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="nerve-fiber.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "libs/mathjax-local/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
